<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="my-data">
  <template>
    <style>
      :host {
        display: none;
      }
    </style>
  </template>

  <script>
    Polymer({
      is: 'my-data',
      properties: {
        proliferating: {
          type: Object,
          value: {
            value: false,
          }, // shared among instances
        },
        instances: {
          type: Array,
          value: [], // shared among instances
        },
        share: {
          type: Object,
          value: {
            value: ''
          }, // shared among instances
        },
      },

      observers: [
        'proliferateChange(share.*)',
      ],

      ready() {
        // update list of instances
        this.instances.push(this);

        // update host's share
        this.parentNode.host.share = this.share;
      },

      proliferateChange(changes) {
        if (!this.proliferating.value) {
          // notify hosts of other instances
          this.instances.forEach((instance) => {
            if (instance !== this) {
              console.info(`event from my-data in:${this.parentNode.host.nodeName} to my-data in:${instance.parentNode.host.nodeName}`);
              this.proliferating.value = true;
              this.fire('share-changed',
                changes,
                {
                node: instance,
                bubbles: false,
              });
              this.proliferating.value = false;
            }
          });
        }
      },
    });
  </script>
</dom-module>
